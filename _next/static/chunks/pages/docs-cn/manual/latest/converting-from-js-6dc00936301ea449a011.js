(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[36130],{17375:function(e,t,n){"use strict";function a(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}n.d(t,{Z:function(){return a}})},62741:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var a=n(17375),r=n(96156),l=(n(67294),n(3905));function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p,s=(p="CodeTab",function(e){return console.warn("Component "+p+" was not imported, exported, or provided by MDXProvider as global scope"),(0,l.kt)("div",i({},e))}),u={};function d(e){var t=e.components,n=(0,a.Z)(e,["components"]);return(0,l.kt)("wrapper",i(i(i({},u),n),{},{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",i({},{id:"converting-from-js--\u4ece-js-\u8f6c\u6362"}),"Converting from JS | \u4ece JS \u8f6c\u6362"),(0,l.kt)("p",null,"ReScript offers a unique project conversion methodology which:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Ensures minimal disruption to your teammates (very important!)."),(0,l.kt)("li",{parentName:"ul"},"Remove the typical friction of verifying conversion's correctness and performance guarantees."),(0,l.kt)("li",{parentName:"ul"},"Doesn't force you to search for pre-made binding libraries made by others. ",(0,l.kt)("strong",{parentName:"li"},"ReScript doesn't need the equivalent of TypeScript's ",(0,l.kt)("inlineCode",{parentName:"strong"},"DefinitelyTyped")),".")),(0,l.kt)("p",null,"ReScript \u63d0\u4f9b\u4e86\u72ec\u7279\u7684\u9879\u76ee\u8f6c\u6362\u65b9\u5f0f\uff0c\u8fd9\u79cd\u8f6c\u6362\u65b9\u5f0f\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u786e\u4fdd\u5bf9\u961f\u53cb\u7684\u5e72\u6270\u6700\u5c0f\uff08\u975e\u5e38\u91cd\u8981\uff01\uff09\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u6d88\u9664\u4e86\u9a8c\u8bc1\u8f6c\u6362\u6b63\u786e\u6027\u4e0e\u6027\u80fd\u4fdd\u8bc1\u7684\u5178\u578b\u6469\u64e6\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u4e0d\u5f3a\u5236\u4f60\u641c\u7d22\u4ed6\u4eba\u9884\u5236\u7684\u7ed1\u5b9a\u5e93\u3002",(0,l.kt)("strong",{parentName:"li"},"ReScript \u65e0\u9700 TypeScript \u7684 ",(0,l.kt)("inlineCode",{parentName:"strong"},"DefinitelyTyped")," \u7684\u7b49\u4ef7\u7269"),"\u3002")),(0,l.kt)("h2",i({},{id:"step-1-install-rescript--\u6b65\u9aa4-1\uff1a\u5b89\u88c5-rescript"}),"Step 1: Install ReScript | \u6b65\u9aa4 1\uff1a\u5b89\u88c5 ReScript"),(0,l.kt)("p",null,"Run ",(0,l.kt)("inlineCode",{parentName:"p"},"npm install rescript --save-dev")," on your project, then imitate our ",(0,l.kt)("a",i({parentName:"p"},{href:"installation#new-project"}),"New Project")," workflow by adding a ",(0,l.kt)("inlineCode",{parentName:"p"},"bsconfig.json")," at the root. Then start ",(0,l.kt)("inlineCode",{parentName:"p"},"npx rescript build -w"),"."),(0,l.kt)("p",null,"\u5728\u4f60\u7684\u9879\u76ee\u4e2d\u8fd0\u884c ",(0,l.kt)("inlineCode",{parentName:"p"},"npm install rescript --save-dev"),"\uff0c\u7136\u540e\u50cf\u6211\u4eec\u5728",(0,l.kt)("a",i({parentName:"p"},{href:"installation#new-project"}),"\u65b0\u9879\u76ee"),"\u4e2d\u7684\u5de5\u4f5c\u6d41\u7a0b\u4e00\u6837\uff0c\u5c06 ",(0,l.kt)("inlineCode",{parentName:"p"},"bsconfig.json")," \u6dfb\u52a0\u5230\u9879\u76ee\u6839\u76ee\u5f55\u3002\u63a5\u7740\uff0c\u5f00\u59cb\u6267\u884c ",(0,l.kt)("inlineCode",{parentName:"p"},"npx rescript build -w"),"\u3002"),(0,l.kt)("h2",i({},{id:"step-2-copy-paste-the-entire-js-file--\u6b65\u9aa4-2\uff1a\u590d\u5236\u7c98\u8d34\u6574\u4e2a-js-\u6587\u4ef6"}),"Step 2: Copy Paste the Entire JS File | \u6b65\u9aa4 2\uff1a\u590d\u5236\u7c98\u8d34\u6574\u4e2a JS \u6587\u4ef6"),(0,l.kt)("p",null,"Let's work on converting a file called ",(0,l.kt)("inlineCode",{parentName:"p"},"src/main.js"),"."),(0,l.kt)("p",null,"\u8ba9\u6211\u4eec\u8f6c\u6362 ",(0,l.kt)("inlineCode",{parentName:"p"},"src/main.js")," \u8fd9\u4e2a\u6587\u4ef6\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",i({parentName:"pre"},{className:"language-js"}),"const school = require('school');\n\nconst defaultId = 10;\n\nfunction queryResult(usePayload, payload) {\n  if (usePayload) {\n    return payload.student;\n  } else {\n    return school.getStudentById(defaultId);\n  }\n}\n")),(0,l.kt)("p",null,"First, copy the entire file content over to a new file called ",(0,l.kt)("inlineCode",{parentName:"p"},"src/Main.res")," by using our ",(0,l.kt)("a",i({parentName:"p"},{href:"embed-raw-javascript"}),(0,l.kt)("inlineCode",{parentName:"a"},"%%raw")," JS embedding trick"),":"),(0,l.kt)("p",null,"\u9996\u5148\uff0c\u4f7f\u7528 ",(0,l.kt)("a",i({parentName:"p"},{href:"embed-raw-javascript"}),(0,l.kt)("inlineCode",{parentName:"a"},"%%raw")," JS \u5d4c\u5165\u6280\u5de7"),"\uff0c\u5c06\u6574\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9\u590d\u5236\u5230\u4e00\u4e2a\u65b0\u6587\u4ef6 ",(0,l.kt)("inlineCode",{parentName:"p"},"src/Main.res")," \u4e2d\uff0c"),(0,l.kt)(s,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,l.kt)("pre",null,(0,l.kt)("code",i({parentName:"pre"},{className:"language-res",metastring:"example",example:!0}),"%%raw(`\nconst school = require('school');\n\nconst defaultId = 10;\n\nfunction queryResult(usePayload, payload) {\n  if (usePayload) {\n    return payload.student;\n  } else {\n    return school.getStudentById(defaultId);\n  }\n}\n`)\n")),(0,l.kt)("pre",null,(0,l.kt)("code",i({parentName:"pre"},{className:"language-js"}),"// Generated by ReScript, PLEASE EDIT WITH CARE\n'use strict';\n\nconst school = require('school');\n\nconst defaultId = 10;\n\nfunction queryResult(usePayload, payload) {\n  if (usePayload) {\n    return payload.student;\n  } else {\n    return school.getStudentById(defaultId);\n  }\n}\n\n/*  Not a pure module */\n"))),(0,l.kt)("p",null,"Add this file to ",(0,l.kt)("inlineCode",{parentName:"p"},"bsconfig.json"),":"),(0,l.kt)("p",null,"\u5c06\u4e0b\u9762\u7684\u5185\u5bb9\u6dfb\u52a0\u5230 ",(0,l.kt)("inlineCode",{parentName:"p"},"bsconfig.json"),"\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",i({parentName:"pre"},{className:"language-json"}),'  "sources": {\n    "dir" : "src",\n    "subdirs" : true\n  },\n')),(0,l.kt)("p",null,"Open an editor tab for ",(0,l.kt)("inlineCode",{parentName:"p"},"src/Main.bs.js"),". Do a command-line ",(0,l.kt)("inlineCode",{parentName:"p"},"diff -u src/main.js src/Main.bs.js"),". Aside from whitespaces, you should see only minimal, trivial differences. You're already a third of the way done!"),(0,l.kt)("p",null,"\u5728\u7f16\u8f91\u5668\u4e2d\u6253\u5f00\u4e00\u4e2a\u9009\u9879\u5361\u6765\u67e5\u770b ",(0,l.kt)("inlineCode",{parentName:"p"},"src/Main.bs.js"),"\u3002\u6267\u884c\u547d\u4ee4 ",(0,l.kt)("inlineCode",{parentName:"p"},"diff -u src/main.js src/Main.bs.js"),"\u3002\u9664\u4e86\u7a7a\u683c\u4ee5\u5916\uff0c\u4f60\u5e94\u8be5\u53ea\u80fd\u770b\u5230\u4e00\u4e9b\u6781\u5c0f\u7684\u3001\u5fae\u4e0d\u8db3\u9053\u7684\u5dee\u522b\u3002\u4f60\u5df2\u7ecf\u5b8c\u6210\u4e86\u4e09\u5206\u4e4b\u4e00\uff01"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Always make sure")," that at each step, you keep the ReScript output ",(0,l.kt)("inlineCode",{parentName:"p"},".bs.js")," file open to compare against the existing JavaScript file. Our compilation output is very close to your hand-written JavaScript; you can simply eye the difference to catch conversion bugs!"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u59cb\u7ec8\u786e\u4fdd"),"\u5728\u6bcf\u4e2a\u6b65\u9aa4\u4e2d\u90fd\u4fdd\u6301\u6253\u5f00 ReScript \u8f93\u51fa\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},".bs.js")," \u6587\u4ef6\u6765\u4e0e\u73b0\u6709\u7684 JavaScript \u6587\u4ef6\u8fdb\u884c\u6bd4\u8f83\u3002\u6211\u4eec\u7684\u7f16\u8bd1\u8f93\u51fa\u4e0e\u4f60\u624b\u5199\u7684 JavaScript \u975e\u5e38\u63a5\u8fd1\uff1b\u4f60\u53ef\u4ee5\u901a\u8fc7\u7b80\u5355\u7684\u89c2\u5bdf\u6765\u6355\u6349\u8f6c\u6362\u7684\u5c0f\u866b\u5b50\uff08Bug\uff09\uff01"),(0,l.kt)("h2",i({},{id:"step-3-extract-parts-into-idiomatic-rescript--\u6b65\u9aa4-3\uff1a\u5c06\u90e8\u5206\u63d0\u53d6\u4e3a\u5730\u9053\u7684-rescript"}),"Step 3: Extract Parts into Idiomatic ReScript | \u6b65\u9aa4 3\uff1a\u5c06\u90e8\u5206\u63d0\u53d6\u4e3a\u5730\u9053\u7684 ReScript"),(0,l.kt)("p",null,"Let's turn the ",(0,l.kt)("inlineCode",{parentName:"p"},"defaultId")," variable into a ReScript let-binding:"),(0,l.kt)("p",null,"\u8ba9\u6211\u4eec\u5c06\u53d8\u91cf ",(0,l.kt)("inlineCode",{parentName:"p"},"defaultId")," \u8f6c\u4e3a let \u7ed1\u5b9a\uff1a"),(0,l.kt)(s,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,l.kt)("pre",null,(0,l.kt)("code",i({parentName:"pre"},{className:"language-res",metastring:"example",example:!0}),"let defaultId = 10\n\n%%raw(`\nconst school = require('school');\n\nfunction queryResult(usePayload, payload) {\n  if (usePayload) {\n    return payload.student;\n  } else {\n    return school.getStudentById(defaultId);\n  }\n}\n`)\n")),(0,l.kt)("pre",null,(0,l.kt)("code",i({parentName:"pre"},{className:"language-js"}),"// Generated by ReScript, PLEASE EDIT WITH CARE\n'use strict';\n\n\nconst school = require('school');\n\nfunction queryResult(usePayload, payload) {\n  if (usePayload) {\n    return payload.student;\n  } else {\n    return school.getStudentById(defaultId);\n  }\n}\n\nvar defaultId = 10;\n\nexports.defaultId = defaultId;\n/*  Not a pure module */\n"))),(0,l.kt)("p",null,"Check the output. Diff it. Code still works. Moving on! Extract the function:"),(0,l.kt)("p",null,"\u68c0\u67e5\u8f93\u51fa\u3002\u6bd4\u8f83\u5dee\u5f02\u3002\u4ee3\u7801\u4ecd\u7136\u5de5\u4f5c\u3002\u7ee7\u7eed\u524d\u8fdb\uff01\u63d0\u53d6\u51fd\u6570\uff1a"),(0,l.kt)(s,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,l.kt)("pre",null,(0,l.kt)("code",i({parentName:"pre"},{className:"language-res"}),"%%raw(`\nconst school = require('school');\n`)\n\nlet defaultId = 10\n\nlet queryResult = (usePayload, payload) => {\n  if usePayload {\n    payload.student\n  } else {\n    school.getStudentById(defaultId)\n  }\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",i({parentName:"pre"},{className:"language-js"}),""))),(0,l.kt)("p",null,"Format the code: ",(0,l.kt)("inlineCode",{parentName:"p"},"./node_modules/.bin/rescript format src/Main.res"),"."),(0,l.kt)("p",null,"\u683c\u5f0f\u5316\u4ee3\u7801\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"./node_modules/.bin/rescript format src/Main.res"),"\u3002"),(0,l.kt)("p",null,"We have a type error: \"The record field student can't be found\". That's fine! ",(0,l.kt)("strong",{parentName:"p"},"Always ensure your code is syntactically valid first"),". Fixing type errors comes later."),(0,l.kt)("p",null,"\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a\u7c7b\u578b\u9519\u8bef\uff1a\u201cThe record field student can't be found\u201d\u3002\u6ca1\u5173\u7cfb\uff01",(0,l.kt)("strong",{parentName:"p"},"\u59cb\u7ec8\u4f18\u5148\u786e\u4fdd\u4f60\u4ee3\u7801\u7684\u8bed\u6cd5\u662f\u6709\u6548\u7684"),"\u3002\u7a0d\u540e\u4f1a\u4fee\u590d\u7c7b\u578b\u9519\u8bef\u3002"),(0,l.kt)("h2",i({},{id:"step-4-add-externals-fix-types--\u6b65\u9aa4-4\uff1a\u6dfb\u52a0-external\uff0c\u4fee\u590d\u7c7b\u578b"}),"Step 4: Add ",(0,l.kt)("inlineCode",{parentName:"h2"},"external"),"s, Fix Types | \u6b65\u9aa4 4\uff1a\u6dfb\u52a0 ",(0,l.kt)("inlineCode",{parentName:"h2"},"external"),"\uff0c\u4fee\u590d\u7c7b\u578b"),(0,l.kt)("p",null,"The previous type error is caused by ",(0,l.kt)("inlineCode",{parentName:"p"},"payload"),"'s record declaration (which supposedly contains the field ",(0,l.kt)("inlineCode",{parentName:"p"},"student"),") not being found. Since we're trying to convert as quickly as possible, let's use our ",(0,l.kt)("a",i({parentName:"p"},{href:"object"}),"object")," feature to avoid needing type declaration ceremonies:"),(0,l.kt)("p",null,"\u524d\u9762\u7684\u7c7b\u578b\u9519\u8bef\u662f\u56e0\u4e3a\u6ca1\u6709\u627e\u5230 ",(0,l.kt)("inlineCode",{parentName:"p"},"payload")," \u7684\u8bb0\u5f55\u58f0\u660e\uff08\u5b83\u5e94\u8be5\u5305\u542b ",(0,l.kt)("inlineCode",{parentName:"p"},"student")," \u5b57\u6bb5\uff09\u3002\u56e0\u4e3a\u6211\u4eec\u60f3\u66f4\u5feb\u7684\u5b8c\u6210\u8f6c\u6362\uff0c\u6240\u4ee5\u5148\u8ba9\u6211\u4eec\u7528",(0,l.kt)("a",i({parentName:"p"},{href:"object"}),"\u5bf9\u8c61"),"\u7279\u6027\u6765\u907f\u514d\u7c7b\u578b\u58f0\u660e\u7684\u4eea\u5f0f\u3002"),(0,l.kt)(s,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,l.kt)("pre",null,(0,l.kt)("code",i({parentName:"pre"},{className:"language-res"}),'%%raw(`\nconst school = require(\'school\');\n`)\n\nlet defaultId = 10\n\nlet queryResult = (usePayload, payload) => {\n  if usePayload {\n    payload["student"]\n  } else {\n    school["getStudentById"](defaultId)\n  }\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",i({parentName:"pre"},{className:"language-js"}),""))),(0,l.kt)("p",null,"Now this triggers the next type error, that ",(0,l.kt)("inlineCode",{parentName:"p"},"school")," isn't found. Let's use ",(0,l.kt)("a",i({parentName:"p"},{href:"external"}),(0,l.kt)("inlineCode",{parentName:"a"},"external"))," to bind to that module:"),(0,l.kt)("p",null,"\u73b0\u5728\u8fd9\u89e6\u53d1\u4e86\u4e0b\u4e00\u4e2a\u7c7b\u578b\u9519\u8bef\uff0c\u5373\u627e\u4e0d\u5230 ",(0,l.kt)("inlineCode",{parentName:"p"},"school"),"\u3002\u8ba9\u6211\u4eec\u4f7f\u7528 ",(0,l.kt)("a",i({parentName:"p"},{href:"external"}),(0,l.kt)("inlineCode",{parentName:"a"},"external"))," \u6765\u7ed1\u5b9a\u8fd9\u4e2a\u6a21\u5757\uff1a"),(0,l.kt)(s,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,l.kt)("pre",null,(0,l.kt)("code",i({parentName:"pre"},{className:"language-res",metastring:"example",example:!0}),'@module external school: \'whatever = "school"\n\nlet defaultId = 10\n\nlet queryResult = (usePayload, payload) => {\n  if usePayload {\n    payload["student"]\n  } else {\n    school["getStudentById"](defaultId)\n  }\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",i({parentName:"pre"},{className:"language-js"}),"// Generated by ReScript, PLEASE EDIT WITH CARE\n'use strict';\n\nvar School = require(\"school\");\n\nfunction queryResult(usePayload, payload) {\n  if (usePayload) {\n    return payload.student;\n  } else {\n    return School.getStudentById(10);\n  }\n}\n\nvar defaultId = 10;\n\nexports.defaultId = defaultId;\nexports.queryResult = queryResult;\n/* school Not a pure module */\n"))),(0,l.kt)("p",null,"We hurrily typed ",(0,l.kt)("inlineCode",{parentName:"p"},"school")," as a polymorphic ",(0,l.kt)("inlineCode",{parentName:"p"},"'whatever")," and let its type be inferred by its usage below. The inference is technically correct, but within the context of bringing it a value from JavaScript, slightly dangerous. This is just the interop trick we've shown in the ",(0,l.kt)("a",i({parentName:"p"},{href:"external"}),(0,l.kt)("inlineCode",{parentName:"a"},"external"))," page."),(0,l.kt)("p",null,"\u6211\u4eec\u5306\u5fd9\u5730\u5c06 ",(0,l.kt)("inlineCode",{parentName:"p"},"school")," \u7684\u7c7b\u578b\u6ce8\u91ca\u4e3a\u4e00\u4e2a\u591a\u6001\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"'whatever"),"\uff0c\u5e76\u901a\u8fc7\u4e0b\u9762\u7684\u7528\u6cd5\u63a8\u65ad\u5176\u7c7b\u578b\u3002\u8fd9\u4e2a\u63a8\u65ad\u5728\u6280\u672f\u4e0a\u662f\u6b63\u786e\u7684\uff0c\u4f46\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"school")," \u7684\u503c\u6765\u81ea\u4e8e JavaScript\uff0c\u5728\u8fd9\u79cd\u80cc\u666f\u4e0b\uff0c\u8fd9\u6709\u4e9b\u5371\u9669\u3002"),(0,l.kt)("p",null,"Anyway, the file passes the type checker again. Check the ",(0,l.kt)("inlineCode",{parentName:"p"},".bs.js")," output, diff with the original ",(0,l.kt)("inlineCode",{parentName:"p"},".js"),"; we've now converted a file over to ReScript!"),(0,l.kt)("p",null,"\u4e0d\u7ba1\u600e\u6837\uff0c\u8fd9\u4e2a\u6587\u4ef6\u518d\u6b21\u901a\u8fc7\u4e86\u7c7b\u578b\u68c0\u67e5\u5668\u3002\u68c0\u67e5 ",(0,l.kt)("inlineCode",{parentName:"p"},".bs.js")," \u7684\u8f93\u51fa\uff0c\u6bd4\u8f83\u548c\u539f\u59cb ",(0,l.kt)("inlineCode",{parentName:"p"},".js")," \u6587\u4ef6\u7684\u5dee\u5f02\uff1b\u6211\u4eec\u73b0\u5728\u5c06\u6587\u4ef6\u8f6c\u4e3a\u4e86 ReScript\uff01"),(0,l.kt)("p",null,"Now, you can delete the original, hand-written ",(0,l.kt)("inlineCode",{parentName:"p"},"main.js")," file, and grep the files importing ",(0,l.kt)("inlineCode",{parentName:"p"},"main.js")," and change them to importing ",(0,l.kt)("inlineCode",{parentName:"p"},"Main.bs.js"),"."),(0,l.kt)("p",null,"\u73b0\u5728\uff0c\u4f60\u53ef\u4ee5\u5220\u9664\u539f\u6765\u7684\u3001\u624b\u5199\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"main.js")," \u6587\u4ef6\uff0c\u7136\u540e grep\uff08\u641c\u7d22\uff09\u5bfc\u5165\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"main.js")," \u7684\u6587\u4ef6\uff0c\u5e76\u6539\u4e3a\u4ece ",(0,l.kt)("inlineCode",{parentName:"p"},"Main.bs.js")," \u5bfc\u5165\u3002"),(0,l.kt)("h2",i({},{id:"optional-step-5-cleanup--\uff08\u53ef\u9009\uff09\u6b65\u9aa4-5\uff1a\u6e05\u7406"}),"(Optional) Step 5: Cleanup | \uff08\u53ef\u9009\uff09\u6b65\u9aa4 5\uff1a\u6e05\u7406"),(0,l.kt)("p",null,"If you prefer more advanced, rigidly typed ",(0,l.kt)("inlineCode",{parentName:"p"},"payload")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"school"),", feel free to do so:"),(0,l.kt)("p",null,"\u5982\u679c\u4f60\u559c\u6b22\u66f4\u9ad8\u7ea7\u3001\u66f4\u4e25\u683c\u7c7b\u578b\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"payload")," \u4e0e ",(0,l.kt)("inlineCode",{parentName:"p"},"school"),"\uff0c\u8bf7\u968f\u610f\u4fee\u6539\uff1a"),(0,l.kt)(s,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,l.kt)("pre",null,(0,l.kt)("code",i({parentName:"pre"},{className:"language-res",metastring:"example",example:!0}),'type school\ntype student\ntype payload = {\n  student: student\n}\n\n@module external school: school = "school"\n@send external getStudentById: (school, int) => student = "getStudentById"\n\nlet defaultId = 10\n\nlet queryResult = (usePayload, payload) => {\n  if usePayload {\n    payload.student\n  } else {\n    school->getStudentById(defaultId)\n  }\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",i({parentName:"pre"},{className:"language-js"}),"// Generated by ReScript, PLEASE EDIT WITH CARE\n'use strict';\n\nvar School = require(\"school\");\n\nfunction queryResult(usePayload, payload) {\n  if (usePayload) {\n    return payload.student;\n  } else {\n    return School.getStudentById(10);\n  }\n}\n\nvar defaultId = 10;\n\nexports.defaultId = defaultId;\nexports.queryResult = queryResult;\n/* school Not a pure module */\n"))),(0,l.kt)("p",null,"We've:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"introduced an opaque types for ",(0,l.kt)("inlineCode",{parentName:"li"},"school")," and ",(0,l.kt)("inlineCode",{parentName:"li"},"student")," to prevent misusages their values"),(0,l.kt)("li",{parentName:"ul"},"typed the payload as a record with only the ",(0,l.kt)("inlineCode",{parentName:"li"},"student")," field"),(0,l.kt)("li",{parentName:"ul"},"typed ",(0,l.kt)("inlineCode",{parentName:"li"},"getStudentById")," as the sole method of ",(0,l.kt)("inlineCode",{parentName:"li"},"student"))),(0,l.kt)("p",null,"\u6211\u4eec\u5df2\u7ecf\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4e3a ",(0,l.kt)("inlineCode",{parentName:"li"},"school")," \u548c ",(0,l.kt)("inlineCode",{parentName:"li"},"student")," \u5f15\u5165\u4e86\u4e00\u79cd\u4e0d\u900f\u660e\u7684\u7c7b\u578b\u4ee5\u9632\u6b62\u6ee5\u7528\u5b83\u4eec\u7684\u503c"),(0,l.kt)("li",{parentName:"ul"},"\u5c06 payload \u58f0\u660e\u4e3a\u4e00\u4e2a\u4ec5\u6709 ",(0,l.kt)("inlineCode",{parentName:"li"},"student")," \u5b57\u6bb5\u7684\u8bb0\u5f55"),(0,l.kt)("li",{parentName:"ul"},"\u5c06 ",(0,l.kt)("inlineCode",{parentName:"li"},"getStudentById")," \u58f0\u660e\u4e3a ",(0,l.kt)("inlineCode",{parentName:"li"},"student")," \u7684\u552f\u4e00\u65b9\u6cd5")),(0,l.kt)("p",null,"Check that the ",(0,l.kt)("inlineCode",{parentName:"p"},".bs.js")," output didn't change. How rigidly to type your JavaScript code is up to you; we recommend not typing them too elaborately; it's sometime an endless chase, and produces diminishing returns, especially considering that the elaborate-ness might turn off your potential teammates."),(0,l.kt)("p",null,"\u68c0\u67e5 ",(0,l.kt)("inlineCode",{parentName:"p"},".bs.js"),"\uff0c\u8f93\u51fa\u6ca1\u6709\u6539\u53d8\u3002JavaScript \u4ee3\u7801\u7c7b\u578b\u7684\u4e25\u683c\u7a0b\u5ea6\u53d6\u51b3\u4e8e\u4f60\uff1b\u6211\u4eec\u5efa\u8bae\u4e0d\u8981\u5c06\u5b83\u4eec\u7684\u7c7b\u578b\u5199\u7684\u592a\u8be6\u7ec6\uff1b\u6709\u65f6\u8fd9\u5c31\u50cf\u662f\u4e00\u4e2a\u65e0\u5e95\u6d1e\uff0c\u5e26\u6765\u7684\u6536\u76ca\u4e5f\u4f1a\u8d8a\u6765\u8d8a\u5c11\uff0c\u7279\u522b\u662f\u8981\u8003\u8651\u7cbe\u5fc3\u7684\u8bbe\u8ba1\u53ef\u80fd\u4f1a\u8ba9\u4f60\u7684\u4e00\u4e9b\u961f\u53cb\u5f88\u53cd\u611f\u3002"),(0,l.kt)("h2",i({},{id:"tips--tricks--\u63d0\u793a--\u6280\u5de7"}),"Tips & Tricks | \u63d0\u793a & \u6280\u5de7"),(0,l.kt)("p",null,"In the same vein of idea, ",(0,l.kt)("strong",{parentName:"p"},"resist the urge to write your own wrapper functions for the JS code you're converting"),". Use ",(0,l.kt)("a",i({parentName:"p"},{href:"external"}),(0,l.kt)("inlineCode",{parentName:"a"},"external"),"s"),", which are guaranteed to be erased in the output. And avoid trying to take the occasion to convert JS data structures into ReScript-specific data structures like variant or list. ",(0,l.kt)("strong",{parentName:"p"},"This isn't the time for that"),"."),(0,l.kt)("p",null,"\u672c\u7740\u540c\u6837\u7684\u60f3\u6cd5\uff0c",(0,l.kt)("strong",{parentName:"p"},"\u62b5\u5236\u4e3a\u8981\u8f6c\u6362\u7684 JS \u4ee3\u7801\u7f16\u5199\u5305\u88c5\u51fd\u6570\u7684\u51b2\u52a8"),"\u3002\u4f7f\u7528",(0,l.kt)("a",i({parentName:"p"},{href:"external"}),(0,l.kt)("inlineCode",{parentName:"a"},"external")),"\uff0c\u4fdd\u8bc1\u5b83\u4e0d\u4f1a\u51fa\u73b0\u5728\u8f93\u51fa\u4e2d\u3002\u5e76\u4e14\u907f\u514d\u5c1d\u8bd5\u5c06 JS \u7684\u6570\u636e\u7ed3\u6784\u8f6c\u6362\u4e3a ReScript \u7279\u5b9a\u7684\u6570\u636e\u7ed3\u6784\uff0c\u50cf\u662f\u53d8\u4f53\uff08variant\uff09\u6216\u5217\u8868\uff08list\uff09\u3002 ",(0,l.kt)("strong",{parentName:"p"},"\u8fd9\u4e0d\u662f\u505a\u8fd9\u4e2a\u7684\u65f6\u5019"),"\u3002"),(0,l.kt)("p",null,'The moment you produce extra conversion code in the output, your skeptical teammate\'s mental model might switch from "I recognize this output" to "this conversion might be introducing more problems than it solves. Why are we testing ReScript again?". Then you\'ve lost.'),(0,l.kt)("p",null,"\u4e00\u65e6\u4f60\u5728\u8f93\u51fa\u4e2d\u4ea7\u751f\u4e86\u989d\u5916\u7684\u4ee3\u7801\uff0c\u4f60\u6301\u6000\u7591\u6001\u5ea6\u7684\u961f\u53cb\u7684\u5fc3\u667a\u6a21\u578b\u53ef\u80fd\u4f1a\u4ece\u201c\u6211\u8ba4\u8bc6\u8fd9\u4e2a\u8f93\u51fa\u201d\u53d8\u4e3a\u201c\u8fd9\u4e2a\u8f6c\u6362\u53ef\u80fd\u5f15\u5165\u7684\u95ee\u9898\u6bd4\u5b83\u89e3\u51b3\u4e86\u7684\u8981\u66f4\u591a\uff0c\u6211\u4eec\u4e3a\u4ec0\u4e48\u8981\u518d\u6b21\u6d4b\u8bd5 ReScript\uff1f\u201d\u3002\u90a3\u4f60\u5c31\u8f93\u4e86\u3002"),(0,l.kt)("h2",i({},{id:"conclusion--\u603b\u7ed3"}),"Conclusion | \u603b\u7ed3"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Paste the JS code into a new ReScript file as embedded raw JS code.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Compile and keep the output file open. Check and diff against original JS file. Free regression tests.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Always make sure your file is syntactically valid. Don't worry about fixing types before that.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"(Ab)use ",(0,l.kt)("a",i({parentName:"p"},{href:"object.md"}),"object")," accesses to quickly convert things over.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Optionally clean up the types for robustness.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Don't go overboard and turn off your boss and fellow teammates.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Proudly display that you've conserved the semantics and performance characteristics during the conversion by showing your teammates the eerily familiar output.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Get promoted for introducing a new technology the safer, mature way.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5c06 JS \u4ee3\u7801\u4ee5\u76f4\u63a5\u5d4c\u5165\u7684\u539f\u59cb JS \u4ee3\u7801\u7684\u5f62\u5f0f\u7c98\u8d34\u5230\u4e00\u4e2a\u65b0\u7684 ReScript \u6587\u4ef6\u4e2d\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u7f16\u8bd1\u5e76\u4fdd\u6301\u6253\u5f00\u8f93\u51fa\u7684\u6587\u4ef6\u3002\u68c0\u67e5\u5e76\u6bd4\u8f83\u548c\u539f\u59cb JS \u6587\u4ef6\u7684\u5dee\u5f02\u3002\u514d\u8d39\u7684\u56de\u5f52\u6d4b\u8bd5\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u603b\u662f\u786e\u4fdd\u4f60\u7684\u6587\u4ef6\u7684\u8bed\u6cd5\u662f\u6709\u6548\u7684\u3002\u5728\u6b64\u4e4b\u524d\u4e0d\u8981\u4e3a\u4fee\u590d\u7c7b\u578b\u800c\u5fe7\u8651\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u4f7f\uff08\u6ee5\uff09\u7528",(0,l.kt)("a",i({parentName:"p"},{href:"object.md"}),"\u5bf9\u8c61"),"\u8bbf\u95ee\u4ee5\u5feb\u901f\u7684\u5b8c\u6210\u8f6c\u6362\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u53ef\u9009\u7684\u6e05\u7406\u7c7b\u578b\u4ee5\u63d0\u9ad8\u7a33\u5065\u6027\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u4e0d\u8981\u505a\u7684\u592a\u8fc7\u706b\u800c\u4f7f\u4f60\u7684\u8001\u677f\u4e0e\u961f\u53cb\u53cd\u611f\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u7ed9\u4f60\u7684\u961f\u53cb\u5c55\u793a\u5f02\u5e38\u719f\u6089\u7684\u8f93\u51fa\uff0c\u81ea\u8c6a\u5730\u8868\u660e\u4f60\u5728\u8f6c\u6362\u4e2d\u4fdd\u7559\u4e86\u8bed\u4e49\u4e0e\u6027\u80fd\u7279\u5f81\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u56e0\u4e3a\u4ee5\u4e00\u79cd\u66f4\u5b89\u5168\u3001\u6210\u719f\u7684\u65b9\u5f0f\u5f15\u5165\u4e00\u79cd\u65b0\u6280\u672f\u800c\u83b7\u5f97\u664b\u5347\u3002"))))}d.isMDXComponent=!0,d.frontmatter={title:"\u4ece JS \u8f6c\u6362",description:"How to convert to ReScript with an existing JS codebase",canonical:"/docs/manual/latest/converting-from-js",__ghEditHref:"https://github.com/butterunderflow/rescript-lang.org-chinese-translation/tree/chinese-translation/pages/docs-cn/manual/latest/converting-from-js.mdx"}},38434:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs-cn/manual/latest/converting-from-js",function(){return n(62741)}])}},function(e){e.O(0,[92888,49774,40179],(function(){return t=38434,e(e.s=t);var t}));var t=e.O();_N_E=t}]);