(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[68214],{17375:function(e,t,n){"use strict";function a(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}n.d(t,{Z:function(){return a}})},89511:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var a=n(17375),r=n(96156),i=(n(67294),n(3905));function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p,u=(p="CodeTab",function(e){return console.warn("Component "+p+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",l({},e))}),s={};function m(e){var t=e.components,n=(0,a.Z)(e,["components"]);return(0,i.kt)("wrapper",l(l(l({},s),n),{},{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",l({},{id:"mutation--\u53ef\u53d8\u503c"}),"Mutation | \u53ef\u53d8\u503c"),(0,i.kt)("p",null,"ReScript has great traditional imperative & mutative programming capabilities. You should use these features sparingly, but sometimes they allow your code to be more performant and written in a more familiar pattern."),(0,i.kt)("h2",l({},{id:"mutate-let-binding--\u53ef\u53d8\u503c\u7ed1\u5b9a"}),"Mutate Let-binding | \u53ef\u53d8\u503c\u7ed1\u5b9a"),(0,i.kt)("p",null,"Let-bindings are immutable, but you can wrap it with a ",(0,i.kt)("inlineCode",{parentName:"p"},"ref"),", exposed as a record with a single mutable field in the standard library:"),(0,i.kt)("p",null,"Let\u7ed1\u5b9a\u662f\u4e0d\u53ef\u53d8\u7684, \u4f46\u662f\u4f60\u53ef\u4ee5\u7528",(0,i.kt)("inlineCode",{parentName:"p"},"ref"),"\u6765\u5305\u88f9\u4e00\u4e2a\u503c, \u4f1a\u66b4\u9732\u4e3a\u4e00\u4e2a\u5e26\u6709\u5355\u4e2a\u53ef\u53d8\u5b57\u6bb5\u7684\u6807\u51c6\u5e93\u8bb0\u5f55(record)."),(0,i.kt)(u,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,i.kt)("pre",null,(0,i.kt)("code",l({parentName:"pre"},{className:"language-res",metastring:"prelude",prelude:!0}),"let myValue = ref(5)\n")),(0,i.kt)("pre",null,(0,i.kt)("code",l({parentName:"pre"},{className:"language-js"}),"var myValue = {\n  contents: 5\n};\n"))),(0,i.kt)("h2",l({},{id:"usage--\u7528\u6cd5"}),"Usage | \u7528\u6cd5"),(0,i.kt)("p",null,"You can get the actual value of a ",(0,i.kt)("inlineCode",{parentName:"p"},"ref")," box through accessing its ",(0,i.kt)("inlineCode",{parentName:"p"},"contents")," field:"),(0,i.kt)("p",null,"\u4f60\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee ",(0,i.kt)("inlineCode",{parentName:"p"},"content")," \u5b57\u6bb5\u83b7\u5f97 ",(0,i.kt)("inlineCode",{parentName:"p"},"ref")," \u5305\u88c5\u7684\u5b9e\u9645\u503c. "),(0,i.kt)(u,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,i.kt)("pre",null,(0,i.kt)("code",l({parentName:"pre"},{className:"language-res",metastring:"example",example:!0}),"let five = myValue.contents // 5\n")),(0,i.kt)("pre",null,(0,i.kt)("code",l({parentName:"pre"},{className:"language-js"}),"var five = myValue.contents;\n"))),(0,i.kt)("p",null,"Assign a new value to ",(0,i.kt)("inlineCode",{parentName:"p"},"myValue")," like so:"),(0,i.kt)("p",null,"\u50cf\u8fd9\u6837\u7ed9",(0,i.kt)("inlineCode",{parentName:"p"},"myValue"),"\u5206\u914d\u4e00\u4e2a\u65b0\u503c:"),(0,i.kt)(u,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,i.kt)("pre",null,(0,i.kt)("code",l({parentName:"pre"},{className:"language-res",metastring:"example",example:!0}),"myValue.contents = 6\n")),(0,i.kt)("pre",null,(0,i.kt)("code",l({parentName:"pre"},{className:"language-js"}),"myValue.contents = 6;\n"))),(0,i.kt)("p",null,"We provide a syntax sugar for this:"),(0,i.kt)("p",null,"\u6211\u4eec\u4e5f\u4e3a\u5176\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8bed\u6cd5\u7cd6: "),(0,i.kt)(u,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,i.kt)("pre",null,(0,i.kt)("code",l({parentName:"pre"},{className:"language-res",metastring:"example",example:!0}),"myValue := 6\n")),(0,i.kt)("pre",null,(0,i.kt)("code",l({parentName:"pre"},{className:"language-js"}),"myValue.contents = 6;\n"))),(0,i.kt)("p",null,"Note that the previous binding ",(0,i.kt)("inlineCode",{parentName:"p"},"five")," stays ",(0,i.kt)("inlineCode",{parentName:"p"},"5"),", since it got the underlying item on the ",(0,i.kt)("inlineCode",{parentName:"p"},"ref")," box, not the ",(0,i.kt)("inlineCode",{parentName:"p"},"ref")," itself."),(0,i.kt)("p",null,"\u8bf7\u6ce8\u610f, \u524d\u4e00\u4e2a\u7ed1\u5b9a",(0,i.kt)("inlineCode",{parentName:"p"},"five"),"\u7684\u503c\u4ecd\u7136\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"5"),", \u56e0\u4e3a\u5b83\u5f97\u5230\u4e86 ",(0,i.kt)("inlineCode",{parentName:"p"},"ref")," \u5305\u88c5\u7684\u5143\u7d20, \u800c\u4e0d\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"ref"),"\u672c\u8eab."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note"),": you might see in the JS output tabs above that ",(0,i.kt)("inlineCode",{parentName:"p"},"ref")," allocates an object. Worry not; local, non-exported ",(0,i.kt)("inlineCode",{parentName:"p"},"ref"),"s allocations are optimized away."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u6ce8\u610f"),": \u4f60\u53ef\u80fd\u5728JS\u8f93\u51fa\u4e2d\u770b\u5230, ",(0,i.kt)("inlineCode",{parentName:"p"},"ref"),"\u5206\u914d\u4e86\u4e00\u4e2a\u5bf9\u8c61. \u4e0d\u7528\u62c5\u5fc3, \u5c40\u90e8\u7684\u4e0d\u4f1a\u5bfc\u51fa\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"ref"),"\u5bfc\u81f4\u7684\u5206\u914d\u4f1a\u88ab\u4f18\u5316\u6389."),(0,i.kt)("h2",l({},{id:"tip--tricks--\u6280\u5de7--\u8bc0\u7a8d"}),"Tip & Tricks | \u6280\u5de7 & \u8bc0\u7a8d"),(0,i.kt)("p",null,"Before reaching for ",(0,i.kt)("inlineCode",{parentName:"p"},"ref"),', know that you can achieve lightweight, local "mutations" through ',(0,i.kt)("a",l({parentName:"p"},{href:"let-binding.md#binding-shadowing"}),"overriding let bindings"),"."),(0,i.kt)("p",null,"\u5728\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"ref")," \u4e4b\u524d, \u8981\u77e5\u9053\u4f60\u53ef\u4ee5\u901a\u8fc7",(0,i.kt)("a",l({parentName:"p"},{href:"let-binding.md#binding-shadowing"}),"\u8986\u76d6let\u7ed1\u5b9a"),'\u5b9e\u73b0\u8f7b\u91cf\u7ea7, \u5c40\u90e8\u7684 "\u53d8\u5316".'))}m.isMDXComponent=!0,m.frontmatter={title:"\u53ef\u53d8\u503c",description:"Imperative and mutative programming capabilities in ReScript",canonical:"/docs/manual/latest/mutation",__ghEditHref:"https://github.com/reason-association/rescript-lang.org/blob/master/pages/docs-cn/manual/latest/mutation.mdx"}},13672:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs-cn/manual/latest/mutation",function(){return n(89511)}])}},function(e){e.O(0,[92888,49774,40179],(function(){return t=13672,e(e.s=t);var t}));var t=e.O();_N_E=t}]);